(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{50:function(e,t,n){e.exports=n.p+"static/media/logo.8f6daf1f.svg"},54:function(e,t,n){e.exports=n(98)},60:function(e,t,n){},61:function(e,t,n){},98:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(26),s=n.n(r),o=(n(60),n(7)),d=n(13),l=n(12),c=n(14),u=n(8),h=n(9),m=n(52),p=n.n(m),f=n(27),v=n.n(f),g=n(22),w=n.n(g),b=n(29),E=n.n(b),y=n(21),S=n.n(y),j=n(10),O=n.n(j),k=n(28),L=n.n(k),N=n(11),F=n.n(N),T=n(53),I=n.n(T),C=n(51),A=n.n(C),U=n(30),R=n.n(U),P=n(31),x=n.n(P),B=n(50),z=n.n(B),D=(n(61),function(){function e(t,n,a){Object(u.a)(this,e),this.name=t,this.type=n,this.key=a.split("."),this.quote=!this.type.startsWith("int")&&!this.type.startsWith("dec")}return Object(h.a)(e,[{key:"getValue",value:function(e){for(var t=e,n=0;n<this.key.length;++n)if(null===(t=t[this.key[n]])||"undefined"===typeof t)return"null";return t=(t=String(t)).split('"').join('\\"'),this.quote?'"'+t+'"':t}}]),e}()),K=function(){function e(t){Object(u.a)(this,e),this.name=t,this.keys=[],this.data={},this.fields=[],this.key="`id`",this.link={}}return Object(h.a)(e,[{key:"addField",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.fields.push(e),t&&(this.link[e.name]=t)}},{key:"setKey",value:function(e){this.key=e}},{key:"add",value:function(e){this.keys.includes(e.id)||(this.data[e.id]=e,this.keys.push(e.id))}},{key:"forEach",value:function(e){var t=this;this.keys.forEach(function(n){e(t.data[n])})}},{key:"filter",value:function(e){var t=this,n=[],a=[];this.keys.forEach(function(i){e(t.data[i])?n.push(i):a.push(i)}),this.keys=n,a.forEach(function(e){delete t.data[e]})}},{key:"generateInsert",value:function(e){var t=this.fields.map(function(t){return t.getValue(e)});return"INSERT INTO "+this.name+" VALUES ("+t.join()+");\n"}},{key:"generateAllInsert",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null==t&&(t=this.keys),!t.length)return"";for(var n="INSERT INTO "+this.name+" VALUES\n",a="",i=t.map(function(t){var n=e.data[t];return"("+e.fields.map(function(e){return e.getValue(n)}).join()+")"}),r=0;r<i.length;r++)r%100===0&&(a+=n),a+=i[r]+(r<i.length-1&&r%100<99?",\n":";\n");return a+="\n"}},{key:"generateCreateStatement",value:function(){var e="CREATE TABLE IF NOT EXISTS "+this.name+" (\n";for(var t in this.fields.forEach(function(t){e+="`"+t.name+"` "+t.type+",\n"}),e+="PRIMARY KEY ("+this.key+")",this.link)e+=",\nKEY (`"+t+"`)";return e+="\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n\n"}},{key:"generateConstraintStatement",value:function(){var e=this,t="ALTER TABLE `"+this.name+"`\n",n=Object.keys(this.link).map(function(t,n){return"    ADD CONSTRAINT `"+e.name+"_ibfk_"+(n+1)+"` FOREIGN KEY (`"+t+"`) REFERENCES `"+e.link[t].name+"` (`id`)"});return n?t+=n.join(",\n")+";\n\n":""}}]),e}(),V=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.show.image?i.a.createElement(O.a,{sm:"4"},i.a.createElement(A.a,{src:this.props.show.image.medium,rounded:!0,fluid:!0})):i.a.createElement(O.a,{sm:"4"});return i.a.createElement(L.a,null,e,i.a.createElement(O.a,{sm:"8"},i.a.createElement("h4",null,this.props.show.name),this.props.children))}}]),t}(a.Component),_=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return i.a.createElement(F.a,{bg:"secondary",text:"white"},i.a.createElement(F.a.Header,null,i.a.createElement(F.a.Title,null,this.props.show.name)),this.props.show.image?i.a.createElement(F.a.Img,{variant:"top",src:this.props.show.image.medium}):i.a.createElement(F.a.Text,null,"Pas d image"),i.a.createElement(F.a.Body,null,i.a.createElement(F.a.Text,{dangerouslySetInnerHTML:{__html:this.props.show.summary}})))}}]),t}(a.Component),Q=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement(S.a.Content,null,this.props.table.keys.map(function(t){return i.a.createElement(S.a.Pane,{eventKey:"#"+t.toString(),key:t.toString()},i.a.createElement(_,{show:e.props.table.data[t]}))}))}}]),t}(a.Component),W=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return this.props.list?i.a.createElement(E.a,null,this.props.list.map(function(t){return i.a.createElement(E.a.Item,{key:t.toString(),action:!0,href:"#"+t.toString()},i.a.createElement(V,{show:e.props.table.data[t]},i.a.createElement(w.a,{variant:"secondary",onClick:function(){return e.props.onClick(t)},size:"lg"},e.props.textButton)))})):i.a.createElement("div",null,"Pas de r\xe9sultat")}}]),t}(a.Component),Y=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(l.a)(t).call(this,e))).state={found:[],selection:[]},n.textInput=i.a.createRef(),n.serie=new K("serie"),n.serie.addField(new D("id","int(11) NOT NULL","id")),n.serie.addField(new D("nom","varchar(255) NOT NULL","name")),n.serie.addField(new D("resume","text","summary")),n.serie.addField(new D("langue","varchar(255)","language")),n.serie.addField(new D("note","decimal(4,2)","rating.average")),n.serie.addField(new D("statut","varchar(64)","status")),n.serie.addField(new D("premiere","date","premiered")),n.serie.addField(new D("url","varchar(255)","url")),n.serie.addField(new D("urlImage","varchar(255)","image.medium")),n.personnage=new K("personnage"),n.personnage.addField(new D("id","int(11) NOT NULL","id")),n.personnage.addField(new D("nom","varchar(255) NOT NULL","name")),n.personnage.addField(new D("urlImage","varchar(255)","image.medium")),n.personne=new K("personne"),n.personne.addField(new D("id","int(11) NOT NULL","id")),n.personne.addField(new D("nom","varchar(255) NOT NULL","name")),n.personne.addField(new D("urlImage","varchar(255)","image.medium")),n.personne.addField(new D("url","varchar(255)","url")),n.personne.addField(new D("naissance","date","birthday")),n.personne.addField(new D("mort","date","deathday")),n.personne.addField(new D("pays","varchar(255)","country.name")),n.jouer=new K("jouer"),n.jouer.addField(new D("idSerie","int(11) NOT NULL","idSerie"),n.serie),n.jouer.addField(new D("idPersonnage","int(11) NOT NULL","idPersonnage"),n.personnage),n.jouer.addField(new D("idPersonne","int(11) NOT NULL","idPersonne"),n.personne),n.jouer.setKey("`idSerie`,`idPersonnage`,`idPersonne`"),n.episode=new K("episode"),n.episode.addField(new D("id","int(11) NOT NULL","id")),n.episode.addField(new D("nom","varchar(255) NOT NULL","name")),n.episode.addField(new D("idSerie","int(11) NOT NULL","idSerie"),n.serie),n.episode.addField(new D("resume","text","summary")),n.episode.addField(new D("numero","int(11)","number")),n.episode.addField(new D("saison","int(11)","season")),n.episode.addField(new D("premiere","date","airdate")),n.episode.addField(new D("urlImage","varchar(255)","image.medium")),n.episode.addField(new D("url","varchar(255)","url")),n.poste=new K("poste"),n.poste.addField(new D("idSerie","int(11) NOT NULL","idSerie"),n.serie),n.poste.addField(new D("idPersonne","int(11) NOT NULL","idPersonne"),n.personne),n.poste.addField(new D("titre","varchar(100) NOT NULL","titre")),n.poste.setKey("`idSerie`,`idPersonne`,`titre`"),n.handleSubmit=n.handleSubmit.bind(Object(o.a)(Object(o.a)(n))),n.handleRemoveShow=n.handleRemoveShow.bind(Object(o.a)(Object(o.a)(n))),n.handleAddShow=n.handleAddShow.bind(Object(o.a)(Object(o.a)(n))),n.downloadSQLFile=n.downloadSQLFile.bind(Object(o.a)(Object(o.a)(n))),n}return Object(c.a)(t,e),Object(h.a)(t,[{key:"handleSubmit",value:function(e){var t=this,n=this.textInput.current.value;if(n.startsWith("#"))for(var a=n.slice(1,n.length).replace(/\s+/g,"").split(","),i=0;i<a.length;++i)this.handleAddShow(parseInt(a[i]));else fetch("https://api.tvmaze.com/search/shows?q="+n).then(function(e){return e.json()}).then(function(e){for(var n in e)t.serie.add(e[n].show);t.setState({found:e.map(function(e){return e.show.id})})}),e.preventDefault()}},{key:"handleRemoveShow",value:function(e){this.setState({selection:this.state.selection.filter(function(t){return t!==e})})}},{key:"handleAddShow",value:function(e){var t=this;this.state.selection.includes(e)||fetch("https://api.tvmaze.com/shows/"+e+"?embed[]=cast&embed[]=crew&embed[]=episodes").then(function(e){return e.json()}).then(function(n){console.log(n),t.serie.add(n);for(var a=n._embedded.cast,i=0;i<a.length;++i){t.personne.add(a[i].person),t.personnage.add(a[i].character);var r=a[i].person.id,s=a[i].character.id;t.jouer.add({id:e+"/"+r+"/"+s,idSerie:e,idPersonnage:s,idPersonne:r})}for(var o=n._embedded.crew,d=0;d<o.length;++d){t.personne.add(o[d].person);var l=o[d].person.id,c=o[d].type;t.poste.add({id:e+"/"+l+"/titre",idSerie:e,idPersonne:l,titre:c})}for(var u=n._embedded.episodes,h=0;h<u.length;++h)u[h].idSerie=e,t.episode.add(u[h]);t.setState(function(t){return{selection:t.selection.includes(e)?t.selection:[e].concat(t.selection),found:t.found.filter(function(t){return t!==e})}})})}},{key:"removeUnused",value:function(){var e=this;this.episode.filter(function(t){return e.state.selection.includes(t.idSerie)||e.state.found.includes(t.idSerie)}),this.jouer.filter(function(t){return e.state.selection.includes(t.idSerie)}),this.poste.filter(function(t){return e.state.selection.includes(t.idSerie)});var t={},n={};this.jouer.forEach(function(e){n[e.idPersonnage]=!0,t[e.idPersonne]=!0}),this.jouer.forEach(function(e){t[e.idPersonne]=!0}),console.log(t),this.personnage.filter(function(e){return n[e.id]}),this.personne.filter(function(e){return t[e.id]})}},{key:"downloadSQLFile",value:function(){this.removeUnused();var e="# Fichier g\xe9n\xe9r\xe9 avec les donn\xe9es de TVmaze, en CC-BY-SA. https://www.tvmaze.com/api \n";e+="# Liste des s\xe9ries incluses, par id :\n",e+="# "+this.state.selection.join(",")+"\n\n\n",e+=this.serie.generateCreateStatement(),e+=this.personne.generateCreateStatement(),e+=this.personnage.generateCreateStatement(),e+=this.jouer.generateCreateStatement(),e+=this.episode.generateCreateStatement(),e+=this.poste.generateCreateStatement(),e+=this.serie.generateAllInsert(this.state.selection),e+=this.personne.generateAllInsert(),e+=this.personnage.generateAllInsert(),e+=this.jouer.generateAllInsert(),e+=this.episode.generateAllInsert(),e+=this.poste.generateAllInsert(),e+=this.jouer.generateConstraintStatement(),e+=this.episode.generateConstraintStatement(),e+=this.poste.generateConstraintStatement(),console.log(e);var t=document.createElement("a"),n=new Blob([e],{type:"text/plain"});t.href=URL.createObjectURL(n),t.download="tvshows.sql",document.body.appendChild(t),t.click()}},{key:"render",value:function(){return i.a.createElement(S.a.Container,null,i.a.createElement(R.a,{bg:"dark",variant:"dark"},i.a.createElement(R.a.Brand,{href:"#home"},i.a.createElement("img",{src:z.a,width:"45",height:"45",className:"d-inline-block align-top",alt:"Serie2SQL"})),i.a.createElement(x.a,{className:"mr-auto"},i.a.createElement(x.a.Link,{href:"https://www.tvmaze.com/api"},"Donn\xe9es : TVMaze API"),i.a.createElement(w.a,{variant:"outline-info",disabled:0===this.state.selection.length,onClick:this.downloadSQLFile},"Exporter la s\xe9lection en SQL")),i.a.createElement(p.a,{inline:!0,onSubmit:this.handleSubmit},i.a.createElement(v.a,{type:"text",placeholder:"Nom de la s\xe9rie",className:"mr-sm-2",ref:this.textInput,autoFocus:!0}),i.a.createElement(w.a,{variant:"outline-info",type:"submit"},"Rechercher"))),i.a.createElement("div",{style:{marginTop:"1em"}}),i.a.createElement(L.a,null,i.a.createElement(O.a,{sm:4},i.a.createElement("h4",null,"S\xe9lection ",i.a.createElement(I.a,{pill:!0,variant:"info"},this.state.selection.length," s\xe9ries")),i.a.createElement(W,{list:this.state.selection,table:this.serie,onClick:this.handleRemoveShow,textButton:"Retirer"})),i.a.createElement(O.a,{sm:4},i.a.createElement("h4",null,"R\xe9sultats de recherche"),i.a.createElement(W,{list:this.state.found,table:this.serie,onClick:this.handleAddShow,textButton:"Ajouter"})),i.a.createElement(O.a,{sm:4},i.a.createElement("h4",null,"D\xe9tail de la s\xe9lection"),i.a.createElement(Q,{table:this.serie}))))}}]),t}(a.Component),q=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement(Y,null))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(97);s.a.render(i.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[54,1,2]]]);
//# sourceMappingURL=main.b54ae793.chunk.js.map